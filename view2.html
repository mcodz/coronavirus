<!DOCTYPE html>
<html>

<head>
    <title>武漢肺炎資訊 - Coronavirus Info.</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!-- Language -->
    <script src="lang.js"></script>

    <!-- Data -->
    <script src="data.js"></script>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" crossorigin=""></script>

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <!-- Popper -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>

    <!-- Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

    <!-- jQuery i18n : https://lokalise.com/blog/localizing-apps-jquery/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.js"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.messagestore.js"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.fallbacks.js"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.language.js"
        crossorigin="anonymous"></script>

</head>

<body>


<!--
    <h3>This is view.html</h3>
    <h3 id="welcome"></h3>
    <h3 data-i18n="welcome"></h3>
    <div style="display:none">中文</div>
-->


    <div class="container-fluid h-100">
        <div class="h-100 d-flex flex-column">
            <div class="row">
                <div class="col-12" style="padding-left: 0px; padding-right: 0px;">
                    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                        <a class="navbar-brand" href="#" data-i18n="head_title">Navbar</a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav mr-auto">
                                <li class="nav-item active">
                                    <a class="nav-link" href="#" data-i18n="home">Home</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-i18n="links">
                                        Links
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <a class="dropdown-item" href="https://wars.vote4.hk/" target="_blank">武漢肺炎民間資訊 - Coronavirus Information</a>
                                        <a class="dropdown-item" href="https://www.chp.gov.hk/tc/features/102465.html" target="_blank">衞生防護中心</a>
                                        <a class="dropdown-item" href="https://www.chp.gov.hk/en/features/102465.html" target="_blank">Centre of Health Protection</a>

                                        <!--
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="#">Something else here</a>
                                        -->
                                    </div>
                                </li>
                                <!--
                                <li class="nav-item">
                                    <a class="nav-link disabled" href="#">Disabled</a>
                                </li>
                                -->
                                <li class="nav-item d-flex flex-row">
                                    <a class="nav-link p-2" id="langC" href="#">中文</a>
                                    <a class="nav-link p-2" id="langE" href="#">English</a>
                                </li>
                            </ul>
                            <!--
                            <form class="form-inline my-2 my-lg-0">
                                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                            </form>
                            -->
                        </div>
                    </nav>
                </div>
            </div>
            <div class="row flex-grow-1">
                <div id="mapView"></div>
            </div>
        </div>
    </div>

</body>

<script>

    $.i18n().load(langStore);
    $.i18n().locale = 'tc';
    $('html').i18n();

    // OSM
    var map = L.map('mapView').setView([22.28552, 114.15769], 10);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {}).addTo(map);

    // L.marker([22.28552, 114.15769]).addTo(map)
    //     .bindPopup('A pretty CSS3 popup.<br> Easily customizable.')
    //     .openPopup();


    L.geoJSON(geojsonFeature, {
        pointToLayer: function (feature, latlng) {
            return L.circleMarker(latlng, {
                radius: 8,
                fillColor: "#ff0000",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            });
        }
    }).bindPopup(function (layer) {

        var desc = layer.feature.properties.desc_c;
        if ($.i18n().locale == "en") {
            desc = layer.feature.properties.desc_e;
        }
        var content = "<table cellpadding=0 cellspacing=0 border=0><tr><td colspan=2><h5>" + desc + "</h5></td></tr>" + 
                      "<tr><td><h6>" + layer.feature.properties.date + "</h6></td>" +
                      "<td align=right>" + "<img style='cursor:pointer' onclick='searchNews(\"" + desc + "\")' src='./images/news.png'/>" + "</td></tr>";
        return content;
    }).addTo(map);

    $("#langC").on('click', function() {
        $.i18n().locale = 'tc';
        $('html').i18n();
    });

    $("#langE").on('click', function() {
        $.i18n().locale = 'en';
        $('html').i18n();
    });

    function searchNews(topic) {
        var search_key = "武漢肺炎 新聞 ";
        if ($.i18n().locale == "en") {
            search_key = "Coronavirus news ";
        }
        window.open("https://www.google.com/search?q="+search_key+topic, "_googlenews");
    }
</script>

</html>